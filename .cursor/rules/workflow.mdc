---
description: 
globs: 
---

# Simple Workflow of the Python Algo


Training:
1. Get training data from Google Sheets
2. Process and clean the data
3. Get embeddings via Replicate
4. Store embeddings in Supabase
5. Update status

Classification:
1. Get new transactions from Google Sheets
2. Get embeddings for new transactions
3. Compare with stored embeddings
4. Write results back to sheets


# Infrastructure
All of this runs on the lowest tiers, so it can happen that they are temporarily paused or need time to wake up.
1. DB runs on Supabase
2. Replicate handles the embeddings model
3. Render is where the python service is deployed.


# database

Account table

-- Table Definition
CREATE TABLE "public"."account" (
    "bert_data" bytea,
    "expenseSheetId" text,
    "trainingRange" text,
    "categorisationRange" text,
    "trainingStatus" text,
    "categorisationStatus" text,
    "userId" text NOT NULL,
    "runStatusTraining" text,
    "runStatusCategorisation" text,
    "trainingTab" text,
    "categorisationTab" text,
    "columnOrderTraining" _jsonb,
    "columnOrderCategorisation" jsonb,
    "role" text DEFAULT 'none'::text,
    "api_key" text,
    PRIMARY KEY ("userId")
);

-- Column Comment
COMMENT ON COLUMN "public"."account"."expenseSheetId" IS 'The Id of the sheet used to do your expenses';
COMMENT ON COLUMN "public"."account"."trainingRange" IS 'The range and sheet name of the training date';
COMMENT ON COLUMN "public"."account"."categorisationRange" IS 'the range that is to be selected for categorising';
COMMENT ON COLUMN "public"."account"."trainingStatus" IS 'status of current training run';
COMMENT ON COLUMN "public"."account"."categorisationStatus" IS 'Status of current categorisation';
COMMENT ON COLUMN "public"."account"."userId" IS 'Auth0 user id';
COMMENT ON COLUMN "public"."account"."runStatusTraining" IS 'String of when the training was last run.';
COMMENT ON COLUMN "public"."account"."runStatusCategorisation" IS 'String of when the categorisation was last run';
COMMENT ON COLUMN "public"."account"."trainingTab" IS 'The tab of the sheet used for training';
COMMENT ON COLUMN "public"."account"."categorisationTab" IS 'The tab of the sheet used for categorisation';
COMMENT ON COLUMN "public"."account"."columnOrderTraining" IS 'Order and type of columns for training purposes.';
COMMENT ON COLUMN "public"."account"."columnOrderCategorisation" IS 'Order of categorisation columns in a users sheet.';